{% extends "appR/dashboard_P.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'appR/css/ordenes.css' %}">
{% endblock %}

{% block contenido_dashboard %}
<div class="panel">

    <div class="header-panel">
        <h2>√ìrdenes de Trabajo</h2>
        <a href="{% url 'orden_create' %}" class="btn-add">+ Nueva Orden</a>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Cliente</th>
                    <th>Servicio</th>
                    <th>Entrega</th>
                    <th>Estado</th>
                    <th>Responsable</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody>
                {% for orden in ordenes %}
                <tr>
                    <td data-label="ID">#{{ orden.id }}</td>

                    <td data-label="Cliente">
                        {{ orden.cliente.nombre }} <br>
                        <small>{{ orden.cliente.tipo_cliente }}</small>
                    </td>

                    <td data-label="Servicio">{{ orden.tipo_servicio }}</td>

                    <td data-label="Entrega">
                        {{ orden.fecha_entrega|date:"d/m/Y" }}
                    </td>

                    <td data-label="Estado">
                        <span class="badge
                            {% if orden.estado == 'Pendiente' %}danger
                            {% elif orden.estado == 'En proceso' %}warn
                            {% elif orden.estado == 'Completado' %}success
                            {% endif %}">
                            {{ orden.estado }}
                        </span>
                    </td>

                    <td data-label="Responsable">
                        {% if orden.responsable %}
                            {{ orden.responsable.nombre_completo }}
                        {% else %}
                            ‚Äî
                        {% endif %}
                    </td>

                    <td data-label="Acciones">
                        <div class="acciones">
                            <a href="{% url 'orden_edit' orden.id %}" class="btn edit">‚úèÔ∏è Editar</a>
                            <button class="btn danger" onclick="openDeleteModal({{ orden.id }})">üóë Eliminar</button>
                            <a href="{% url 'orden_detail' orden.id %}" class="btn warn">üëÅ Ver</a>
                            <a href="{% url 'orden_revision' orden.id %}" class="btn primary">‚öô Revisar</a>
                        </div>
                    </td>
                </tr>

                <!-- MODAL FUERA DEL TR -->
                <div id="deleteModal-{{ orden.id }}" class="modal">
                    <div class="modal-content">
                        <h3>‚ö†Ô∏è Confirmar eliminaci√≥n</h3>
                        <p>¬øEliminar la orden <strong>#{{ orden.id }}</strong>?</p>
                        <form method="POST" action="{% url 'orden_delete' orden.id %}">
                            {% csrf_token %}
                            <div class="modal-actions">
                                <button type="button" class="btn warn" onclick="closeDeleteModal({{ orden.id }})">Cancelar</button>
                                <button type="submit" class="btn danger">S√≠, eliminar</button>
                            </div>
                        </form>
                    </div>
                </div>

                {% empty %}
                <tr>
                    <td colspan="7" style="text-align:center; padding:30px;">
                        No hay √≥rdenes registradas
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function openDeleteModal(id) {
    document.getElementById("deleteModal-" + id).style.display = "flex";
}
function closeDeleteModal(id) {
    document.getElementById("deleteModal-" + id).style.display = "none";
}
</script>
{% endblock %}
