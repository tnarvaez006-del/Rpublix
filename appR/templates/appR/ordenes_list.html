{% extends "appR/dashboard_P.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'appR/css/ordenes.css' %}">
{% endblock %}

{% block contenido_dashboard %}
<div class="panel">

    <!-- HEADER -->
    <div class="header-panel">
        <h2>√ìrdenes de Trabajo</h2>
        <a href="{% url 'orden_create' %}" class="btn-add">+ Nueva Orden</a>
    </div>

    <!-- TABLA -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Cliente</th>
                    <th>Servicio</th>
                    <th>Entrega</th>
                    <th>Estado</th>
                    <th>Responsable</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody>
                {% for orden in ordenes %}
                <tr>

                    <td>#{{ orden.id }}</td>

                    <td>
                        {{ orden.cliente.nombre }} <br>
                        <small>{{ orden.cliente.tipo_cliente }}</small>
                    </td>

                    <td>{{ orden.tipo_servicio }}</td>

                    <td>{{ orden.fecha_entrega|date:"d/m/Y" }}</td>

                    <td>
                        <span class="badge
                            {% if orden.estado == 'Completado' %}success
                            {% elif orden.estado == 'Cancelado' %}danger
                            {% else %}warn{% endif %}">
                            {{ orden.estado }}
                        </span>
                    </td>

                    <td>
                        {% if orden.responsable %}
                            {{ orden.responsable.nombre_completo }}
                        {% else %}
                            ‚Äî
                        {% endif %}
                    </td>

                    <td>

                        <a href="{% url 'orden_edit' orden.id %}" class="btn edit">‚úèÔ∏è Editar</a>

                        <button class="btn small danger"
                                onclick="openDeleteModal({{ orden.id }})">
                            üóë Eliminar
                        </button>

                        <a href="{% url 'orden_detail' orden.id %}" class="btn warn">üëÅ Ver</a>

                        <a href="{% url 'orden_revision' orden.id %}" class="btn primary">
                            ‚öô Revisar orden
                        </a>

                    </td>
                </tr>

                <!-- MODAL POR CADA ORDEN -->
                <div id="deleteModal-{{ orden.id }}" class="modal">
                    <div class="modal-content">
                        <h3>‚ö†Ô∏è Confirmar eliminaci√≥n</h3>
                        <p>
                            ¬øEst√°s seguro de eliminar la orden
                            <strong>#{{ orden.id }}</strong>?
                        </p>

                        <form method="POST" action="{% url 'orden_delete' orden.id %}">
                            {% csrf_token %}
                            <div class="modal-actions">
                                <button type="button" class="btn warn"
                                        onclick="closeDeleteModal({{ orden.id }})">
                                    Cancelar
                                </button>
                                <button type="submit" class="btn danger">
                                    S√≠, eliminar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                {% empty %}
                <tr>
                    <td colspan="7" style="text-align:center; padding:30px;">
                        No hay √≥rdenes registradas
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<script>
function openDeleteModal(id) {
    document.getElementById("deleteModal-" + id).style.display = "flex";
}
function closeDeleteModal(id) {
    document.getElementById("deleteModal-" + id).style.display = "none";
}
</script>

{% endblock %}
